# è™›æ“¬æ©ŸåŸ·è¡ŒæŒ‡å—

## âœ… æµç¨‹å®Œå…¨ä¸€æ¨£ï¼

æ¨é€åˆ° Git å¾Œï¼Œåœ¨è™›æ“¬æ©Ÿä¸ŠåŸ·è¡Œçš„æµç¨‹**åŸºæœ¬ç›¸åŒ**ï¼Œæ‰€æœ‰ä¿®å¾©éƒ½æœƒè‡ªå‹•åŒ…å«ã€‚ä½†éœ€è¦æ³¨æ„ä¸€äº›**å¹³å°å·®ç•°**ã€‚

---

## ğŸ–¥ï¸ å¹³å°å·®ç•°èªªæ˜

### ç•¶å‰ç’°å¢ƒ vs è™›æ“¬æ©Ÿ

| é …ç›® | ç•¶å‰ï¼ˆmacOSï¼‰ | è™›æ“¬æ©Ÿï¼ˆLinuxï¼‰ |
|------|-------------|----------------|
| **æ“ä½œç³»çµ±** | Darwin | Linuxï¼ˆé€šå¸¸æ˜¯ Ubuntu/CentOSï¼‰ |
| **sed å‘½ä»¤** | `sed -i ''` | `sed -i` |
| **è…³æœ¬åŸ·è¡Œ** | å®Œå…¨å…¼å®¹ | å®Œå…¨å…¼å®¹ |
| **Node.js è…³æœ¬** | è·¨å¹³å° | è·¨å¹³å° |
| **Docker** | éœ€è¦ Docker Desktop | éœ€è¦ Docker Engine |

---

## ğŸš€ è™›æ“¬æ©Ÿå®Œæ•´åŸ·è¡Œæµç¨‹

### æ­¥é©Ÿ 1: Clone å°ˆæ¡ˆ

```bash
# åœ¨è™›æ“¬æ©Ÿä¸Š
git clone <your-repo-url> plane-project
cd plane-project

# ç¢ºèªåˆ†æ”¯å’Œæäº¤
git log --oneline -5  # ç¢ºèªçœ‹åˆ°ä½ çš„ä¿®å¾©æäº¤
```

### æ­¥é©Ÿ 2: åŸ·è¡Œè¨­å®šè…³æœ¬ï¼ˆå®Œå…¨ä¸€æ¨£ï¼‰

```bash
chmod +x setup.sh
./setup.sh
```

**é€™æœƒè‡ªå‹•**ï¼š
- âœ… è¤‡è£½æ‰€æœ‰ `.env.example` ç‚º `.env`
- âœ… ç”Ÿæˆ Django SECRET_KEY
- âœ… å•Ÿç”¨ pnpm
- âœ… å®‰è£æ‰€æœ‰ä¾è³´

### æ­¥é©Ÿ 3: ä¿®æ”¹ API ç«¯å£ï¼ˆé‡è¦ï¼ï¼‰âš ï¸

**æ³¨æ„**ï¼šåœ¨ Linux è™›æ“¬æ©Ÿä¸Šï¼Œ`sed` å‘½ä»¤**ä¸éœ€è¦** `''` åƒæ•¸ã€‚

#### æ–¹æ³• 1ï¼šä½¿ç”¨ sedï¼ˆLinux ç‰ˆæœ¬ï¼‰ğŸ§

```bash
# Linux ä¸Šä½¿ç”¨ï¼ˆæ³¨æ„ï¼šæ²’æœ‰ '' åƒæ•¸ï¼‰
sed -i 's|http://localhost:8000|http://localhost:8001|g' apps/admin/.env
sed -i 's|http://localhost:8000|http://localhost:8001|g' apps/web/.env
sed -i 's|http://localhost:8000|http://localhost:8001|g' apps/space/.env
```

#### æ–¹æ³• 2ï¼šä½¿ç”¨é€šç”¨è…³æœ¬ï¼ˆæ¨è–¦ï¼‰âœ¨

å‰µå»ºä¸€å€‹è·¨å¹³å°çš„è…³æœ¬ `fix-api-port.sh`ï¼š

```bash
#!/bin/bash
# è‡ªå‹•æª¢æ¸¬å¹³å°ä¸¦ä½¿ç”¨æ­£ç¢ºçš„ sed å‘½ä»¤

if [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS
    SED_CMD="sed -i ''"
else
    # Linux
    SED_CMD="sed -i"
fi

echo "æª¢æ¸¬åˆ°å¹³å°: $OSTYPE"
echo "æ›´æ–° API ç«¯å£ç‚º 8001..."

$SED_CMD 's|http://localhost:8000|http://localhost:8001|g' apps/admin/.env
$SED_CMD 's|http://localhost:8000|http://localhost:8001|g' apps/web/.env
$SED_CMD 's|http://localhost:8000|http://localhost:8001|g' apps/space/.env

echo "âœ… API ç«¯å£å·²æ›´æ–°"
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
chmod +x fix-api-port.sh
./fix-api-port.sh
```

#### æ–¹æ³• 3ï¼šæ‰‹å‹•ç·¨è¼¯ï¼ˆæœ€å¯é ï¼‰

```bash
# ç·¨è¼¯æ¯å€‹ .env æ–‡ä»¶
nano apps/admin/.env
nano apps/web/.env
nano apps/space/.env

# æŸ¥æ‰¾ä¸¦æ›¿æ›ï¼š
# NEXT_PUBLIC_API_BASE_URL="http://localhost:8000"
# æ”¹ç‚ºï¼š
# NEXT_PUBLIC_API_BASE_URL="http://localhost:8001"
```

### æ­¥é©Ÿ 4: å•Ÿå‹• Docker æœå‹™ï¼ˆå®Œå…¨ä¸€æ¨£ï¼‰

```bash
docker compose -f docker-compose-local.yml up -d
```

**æª¢æŸ¥æœå‹™ç‹€æ…‹**ï¼š
```bash
docker compose -f docker-compose-local.yml ps
```

æ‡‰è©²çœ‹åˆ°æ‰€æœ‰æœå‹™é‹è¡Œä¸­ï¼Œç‰¹åˆ¥æ˜¯ï¼š
- `plane-db` (PostgreSQL)
- `plane-redis`
- `plane-mq` (RabbitMQ)
- `plane-minio`
- `api` (é‹è¡Œåœ¨ 8001 ç«¯å£)
- `worker`
- `beat-worker`

### æ­¥é©Ÿ 5: æ§‹å»ºå…±äº«å¥—ä»¶ï¼ˆå®Œå…¨ä¸€æ¨£ï¼‰

```bash
pnpm build:packages
```

**é€™æ˜¯é—œéµæ­¥é©Ÿ**ï¼æœƒè‡ªå‹•åŸ·è¡Œï¼š
- âœ… æ§‹å»ºæ‰€æœ‰å…±äº«å¥—ä»¶
- âœ… è‡ªå‹•é‹è¡Œ `fix-types.js` ä¿®å¾©é¡å‹æ–‡ä»¶ï¼ˆæ„Ÿè¬ä½ çš„ä¿®å¾©ï¼ï¼‰

### æ­¥é©Ÿ 6: å•Ÿå‹•é–‹ç™¼æœå‹™å™¨ï¼ˆå®Œå…¨ä¸€æ¨£ï¼‰

```bash
pnpm dev
```

### æ­¥é©Ÿ 7: è¨ªå•æ‡‰ç”¨ï¼ˆæ³¨æ„ç¶²çµ¡é…ç½®ï¼‰

#### æœ¬åœ°è¨ªå•ï¼ˆåœ¨è™›æ“¬æ©Ÿä¸Šï¼‰

```bash
# åœ¨è™›æ“¬æ©Ÿå…§éƒ¨è¨ªå•
curl http://localhost:3000
curl http://localhost:3001
curl http://localhost:8001/api/
```

#### é ç¨‹è¨ªå•ï¼ˆå¾ä¸»æ©Ÿè¨ªå•è™›æ“¬æ©Ÿï¼‰

å¦‚æœè™›æ“¬æ©Ÿæœ‰ç¶²è·¯é…ç½®ï¼Œå¯èƒ½éœ€è¦ï¼š

1. **æª¢æŸ¥è™›æ“¬æ©Ÿ IP**ï¼š
```bash
# åœ¨è™›æ“¬æ©Ÿä¸ŠåŸ·è¡Œ
ip addr show  # æˆ– ifconfig
hostname -I
```

2. **é…ç½®é˜²ç«ç‰†**ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š
```bash
# Ubuntu/Debian
sudo ufw allow 3000/tcp
sudo ufw allow 3001/tcp
sudo ufw allow 8001/tcp

# æˆ–è€…é—œé–‰é˜²ç«ç‰†ï¼ˆåƒ…é–‹ç™¼ç’°å¢ƒï¼‰
sudo ufw disable
```

3. **è¨ªå•åœ°å€**ï¼š
```
ä¸»æ‡‰ç”¨: http://<è™›æ“¬æ©ŸIP>:3000
ç®¡ç†ä»‹é¢: http://<è™›æ“¬æ©ŸIP>:3001/god-mode/
API: http://<è™›æ“¬æ©ŸIP>:8001
```

---

## ğŸ“‹ å¹³å°ç‰¹å®šæ³¨æ„äº‹é …

### Linux è™›æ“¬æ©Ÿå¸¸è¦‹å•é¡Œ

#### 1. æ¬Šé™å•é¡Œ

```bash
# å¦‚æœé‡åˆ°æ¬Šé™å•é¡Œ
sudo chown -R $USER:$USER .
chmod +x setup.sh
```

#### 2. Docker æ¬Šé™

```bash
# å¦‚æœç„¡æ³•è¨ªå• Dockerï¼Œå¯èƒ½éœ€è¦å°‡ç”¨æˆ¶åŠ å…¥ docker çµ„
sudo usermod -aG docker $USER
newgrp docker  # æˆ–é‡æ–°ç™»å…¥
```

#### 3. Node.js ç‰ˆæœ¬

```bash
# æª¢æŸ¥ Node.js ç‰ˆæœ¬ï¼ˆéœ€è¦ >= 22.18.0ï¼‰
node --version

# å¦‚æœç‰ˆæœ¬ä¸å°ï¼Œä½¿ç”¨ nvm å®‰è£
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 22
nvm use 22
```

#### 4. pnpm å®‰è£

```bash
# å¦‚æœ pnpm æœªå®‰è£
npm install -g pnpm

# æˆ–ä½¿ç”¨ corepackï¼ˆæ¨è–¦ï¼‰
corepack enable
corepack prepare pnpm@10.12.1 --activate
```

#### 5. è¨˜æ†¶é«”ä¸è¶³

```bash
# æª¢æŸ¥å¯ç”¨è¨˜æ†¶é«”
free -h

# å¦‚æœè¨˜æ†¶é«”ä¸è¶³ï¼Œå¯ä»¥ï¼š
# 1. å¢åŠ è™›æ“¬æ©Ÿåˆ†é…çš„è¨˜æ†¶é«”ï¼ˆè‡³å°‘ 12GBï¼‰
# 2. æˆ–æ¸›å°‘ä¸¦ç™¼æ§‹å»ºæ•¸é‡

# ä¿®æ”¹ package.json ä¸­çš„ dev è…³æœ¬
# å¾ --concurrency=18 æ”¹ç‚ºè¼ƒå°çš„æ•¸å­—ï¼Œå¦‚ --concurrency=4
```

---

## ğŸ” é©—è­‰æ­¥é©Ÿ

### é©—è­‰æ§‹å»ºä¿®å¾©æ˜¯å¦ç”Ÿæ•ˆ

```bash
# 1. æª¢æŸ¥ fix-types.js æ˜¯å¦å­˜åœ¨
ls -la scripts/fix-types.js

# 2. æª¢æŸ¥ package.json æ˜¯å¦åŒ…å«ä¿®å¾©è…³æœ¬
grep "fix-types" packages/utils/package.json

# 3. æ§‹å»ºä¸€å€‹å¥—ä»¶æ¸¬è©¦
cd packages/utils
pnpm build

# 4. æª¢æŸ¥é¡å‹æ–‡ä»¶æ˜¯å¦è¢«æ­£ç¢ºé‡å‘½å
ls -la dist/index.d.*  # æ‡‰è©²çœ‹åˆ° index.d.cts è€Œä¸æ˜¯å¸¶å“ˆå¸Œçš„åç¨±
```

### é©—è­‰ API é€£æ¥

```bash
# æ¸¬è©¦ API æ˜¯å¦å¯è¨ªå•
curl http://localhost:8001/api/instances/

# æ‡‰è©²è¿”å› JSON éŸ¿æ‡‰ï¼Œè€Œä¸æ˜¯é€£æ¥éŒ¯èª¤
```

---

## ğŸ¯ å®Œæ•´å‘½ä»¤åˆ—è¡¨ï¼ˆè¤‡è£½è²¼ä¸Šç‰ˆï¼‰

```bash
# 1. Clone å°ˆæ¡ˆ
git clone <your-repo-url> plane-project
cd plane-project

# 2. è¨­å®šç’°å¢ƒ
chmod +x setup.sh
./setup.sh

# 3. ä¿®æ­£ API ç«¯å£ï¼ˆLinux ç‰ˆæœ¬ï¼‰
sed -i 's|http://localhost:8000|http://localhost:8001|g' apps/admin/.env
sed -i 's|http://localhost:8000|http://localhost:8001|g' apps/web/.env
sed -i 's|http://localhost:8000|http://localhost:8001|g' apps/space/.env

# 4. å•Ÿå‹• Docker
docker compose -f docker-compose-local.yml up -d

# 5. ç­‰å¾…æœå‹™å•Ÿå‹•ï¼ˆç´„ 30 ç§’ï¼‰
sleep 30

# 6. æ§‹å»ºå…±äº«å¥—ä»¶
pnpm build:packages

# 7. å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
pnpm dev
```

---

## âœ… ç¸½çµ

### æµç¨‹å®Œå…¨ä¸€æ¨£ï¼

1. âœ… **æ§‹å»ºä¿®å¾©**ï¼šè‡ªå‹•åŒ…å«ï¼ˆå·²æäº¤åˆ° Gitï¼‰
2. âœ… **æ‰€æœ‰è…³æœ¬**ï¼šè·¨å¹³å°å…¼å®¹
3. âœ… **åŸ·è¡Œæ­¥é©Ÿ**ï¼šå®Œå…¨ç›¸åŒ
4. âš ï¸ **å”¯ä¸€å·®ç•°**ï¼š`sed` å‘½ä»¤çš„èªæ³•ï¼ˆLinux ä¸éœ€è¦ `''`ï¼‰

### é—œéµè¦é»

- âœ… æ§‹å»ºå•é¡Œå·²è§£æ±ºï¼Œä¸éœ€è¦é‡è¤‡ä¿®å¾©
- âš ï¸ ä»éœ€è¦ä¿®æ”¹ `.env` æ–‡ä»¶çš„ API ç«¯å£
- ğŸ’¡ å»ºè­°å‰µå»ºè·¨å¹³å°çš„ `fix-api-port.sh` è…³æœ¬
- ğŸ“ æ‰€æœ‰å…¶ä»–æ­¥é©Ÿå®Œå…¨ç›¸åŒ

---

## ğŸ› ï¸ å¿«é€Ÿæ•…éšœæ’é™¤

### å¦‚æœæ§‹å»ºå¤±æ•—

```bash
# æ¸…ç†ä¸¦é‡æ–°æ§‹å»º
pnpm clean
pnpm install
pnpm build:packages
```

### å¦‚æœ Docker æœå‹™ç„¡æ³•å•Ÿå‹•

```bash
# æª¢æŸ¥ Docker æ˜¯å¦é‹è¡Œ
sudo systemctl status docker

# å•Ÿå‹• Docker
sudo systemctl start docker

# æŸ¥çœ‹æ—¥èªŒ
docker compose -f docker-compose-local.yml logs
```

### å¦‚æœç«¯å£è¡çª

```bash
# æª¢æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
sudo netstat -tulpn | grep -E ':(3000|3001|8001)'

# æˆ–ä½¿ç”¨
sudo ss -tulpn | grep -E ':(3000|3001|8001)'
```

---

**æœ€å¾Œæ›´æ–°**ï¼š2024å¹´12æœˆ1æ—¥

